// 홀센서 제어랑 led제어 둘다 바이너리로 인자값 넘겨주면됨
#include <avr/io.h>
#include <avr/interrupt.h>
#include <util/delay.h> //delay 
#define F_CPU 1000000UL
#define MAX 5
int mode=0;

void delay_ms(int ms){
   volatile int i,j;
   for(i=0;i<ms;i++){
      for(j=0;j<1000;j++){
      ;
      }
   }
}

volatile int count=0;
SIGNAL(SIG_INTERRUPT4){
   if(mode==MAX){
      mode=0;
   }
   mode++;
   delay_ms(10);
}

//현
//unsigned char digitC[7]={0b00000000,0b00000000,0b00000000,0b11111110,0b00000010,0b00000010,0b11110000};
//unsigned char digitB[7]={0b01000000,0b01001100,0b11010010,0b01001100,0b00100000,0b00001001,0b11111111};
//H
//unsigned char digitC[5]={0b11111111,0b10000000,0b10000000,0b10000000,0b11111111};
//unsigned char digitB[5]={0b11111111,0b00000001,0b00000001,0b00000001,0b11111111};
//E
//unsigned char digitC[5]={0b11111111,0b10000001,0b10000001,0b10000001,0b10000001};
//unsigned char digitB[5]={0b11111111,0b10000001,0b10000001,0b10000001,0b10000001};
//HE
//unsigned char digitC[12]={0b11111111,0b10000000,0b10000000,0b10000000,0b11111111,0b00000000,0b00000000,0b11111111,0b10000011,0b10000011,0b10000011,0b10000011};
//unsigned char digitB[12]={0b11111111,0b00000001,0b00000001,0b00000001,0b11111111,0b00000000,0b00000000,0b11111111,0b10000011,0b10000011,0b10000011,0b10000011};
//하트
//unsigned char digitC[11]={0b00000000,0b00000000,0b00000000,0b10000000,0b11110000,0b11111110,0b11110000,0b10000000,0b00000000,0b00000000,0b00000000};
//unsigned char digitB[11]={0b00000000,0b00011000,0b00111100,0b11111111,0b11111111,0b00111111,0b11111111,0b11111111,0b00111100,0b00011000,0b00000000};
//환석
//unsigned char digitC[11]={0b10000000,0b10111000,0b00001000,0b00001000,0b00000000,0b00000000,0b00000000,0b00000000,0b00100000,0b00100000,0b00111100};
//unsigned char digitB[11]={0b00101000,0b01110101,0b00001000,0b00000000,0b01111111,0b00001000,0b00000011,0b00011100,0b00000011,0b00001000,0b01111111};
//김환석
//unsigned char digitC[14] = {0x00, 0b11100000, 0b10100000, 0b11100000, 0b10000000, 0b11110000, 0b10010000, 0b10010000, 0x00, 0x00, 0b10000000, 0b10000000, 0b11110000, 0x00};
//unsigned char digitB[14] = {0b00100010, 0b00100100, 0b00110000, 0b01111110, 0b00101100, 0b01110011, 0b00101100, 0xff, 0b00000100, 0b00001110, 0b00110000, 0b00001110, 0b00000100, 0b00111110};
//최현호
//unsigned char digitC[16]={0b00100000,0b11100000,0b00100000,0b00000000,0b11111000,0b00000000,0b00000000,0b00000000,0b00111000,0b00001000,0b00001000,0b00000000,0b00010000,0b01110000,0b00010000,0b00000000};
//unsigned char digitB[16]={0b00010110,0b00111100,0b00010110,0b01111111,0b00000000,0b00010010,0b01110101,0b00010010,0b00000101,0b00000101,0b01111111,0b00000000,0b00010010,0b01110101,0b00010010,0b00000000};
// 김환석 최현호
unsigned char nameC[30] = {0x00, 0b11100000, 0b10100000, 0b11100000, 0b10000000, 0b11110000, 0b10010000, 0b10010000, 0x00, 0x00, 0b10000000, 0b10000000, 0b11110000, 0x00,0b00100000,0b11100000,0b00100000,0b00000000,0b11111000,0b00000000,0b00000000,0b00000000,0b00111000,0b00001000,0b00001000,0b00000000,0b00010000,0b01110000,0b00010000,0b00000000};
unsigned char nameB[30] = {0b00100010, 0b00100100, 0b00110000, 0b01111110, 0b00101100, 0b01110011, 0b00101100, 0xff, 0b00000100, 0b00001110, 0b00110000, 0b00001110, 0b00000100, 0b00111110,0b00010110,0b00111100,0b00010110,0b01111111,0b00000000,0b00010010,0b01110101,0b00010010,0b00000101,0b00000101,0b01111111,0b00000000,0b00010010,0b01110101,0b00010010,0b00000000};
int namelength=30;
//AM
//unsigned char digitC[12]={0b11111100,0b10000000,0b10000000,0b10000000,0b11111100,0b00000000,0b11111100,0b00000000,0b10000000,0b01110000,0b10000000,0b00000000,0b11111100};
//unsigned char digitB[12]={0b00000011,0b00001100,0b00010000,0b00001100,0b00000011,0b00000000,0b00011111,0b00001110,0b00000011,0b00000000,0b00000011,0b00001110,0b00011111};
//PM
//unsigned char digitC[13]={0b00000000,0b11111111,0b00000000,0b00000000,0b00000000,0b00000000,0b11111100,0b00000000,0b10000000,0b01110000,0b10000000,0b00000000,0b11111100};
//unsigned char digitB[13]={0b00000000,0b01111111,0b01000001,0b00100010,0b00011100,0b00000000,0b00011111,0b00001110,0b00000011,0b00000000,0b00000011,0b00001110,0b00011111};
//3:30
//unsigned char digitC[18]={0b00000000,0b10000001,0b10000001,0b10000001,0b11111111,0b00000000,0b11000000,0b00000000,0b10000001,0b10000001,0b10000001,0b11111111,0b00000000,0b11111111,0b00000001,0b00000001,0b00000001,0b11111111};
//unsigned char digitB[18]={0b00000000,0b01000000,0b01000000,0b01000000,0b11111111,0b00000000,0b00011000,0b00000000,0b01000000,0b01000000,0b01000000,0b11111111,0b00000000,0b11111111,0b01000000,0b01000000,0b01000000,0b11111111};
// PM 3:30
unsigned char timeC[34]={0b00000000,0b11111111,0b00000000,0b00000000,0b00000000,0b00000000,0b11111100,0b00000000,0b10000000,0b01110000,0b10000000,0b00000000,0b11111100,0b00000000,0b00000000,0b00000000,0b10000001,0b10000001,0b10000001,0b11111111,0b00000000,0b11000000,0b00000000,0b10000001,0b10000001,0b10000001,0b11111111,0b00000000,0b11111111,0b00000001,0b00000001,0b00000001,0b11111111,0b00000000};
unsigned char timeB[34]={0b00000000,0b01111111,0b01000001,0b00100010,0b00011100,0b00000000,0b00011111,0b00001110,0b00000011,0b00000000,0b00000011,0b00001110,0b00011111,0b00000000,0b00000000,0b00000000,0b01000000,0b01000000,0b01000000,0b11111111,0b00000000,0b00011000,0b00000000,0b01000000,0b01000000,0b01000000,0b11111111,0b00000000,0b11111111,0b01000000,0b01000000,0b01000000,0b01111111,0b00000000};
int timelength=34;
// 마이크로 프로세스
// PM 3:30
unsigned char microB[53]={0b00001111, 0b00001000, 0b00001000, 0b00001111, 0x00, 0b00011111, 0b00000010,0x00, 0b00001111, 0b00010000, 0b00010000, 0b00001111 , 0x00, 0b00111111, 0x00, 0b00101000, 0b00101000, 0b00101000, 0b00111111, 0x00, 0x00, 0b00101110, 0b00101010, 0b00101011, 0b00111010, 0x00, 0b00100010, 0b00111110, 0b00100010, 0b00111110, 0b00100010, 0x00, 0b00101110, 0b00101010, 0b00101011, 0b00111010, 0x00, 0b00000110, 0b00011000, 0b01100000, 0b00011000, 0b00000110, 0b00001000, 0b01111111, 0x00, 0b01111111, 0x00, 0b00000110, 0b00011000, 0b01100000, 0b00011000, 0b00000110, 0x00};
unsigned char microC[53]={0b10000000, 0b10000000,0b10000000, 0b10000000, 0x00, 0b11000000, 0x00, 0x00, 0x00, 0b10000000, 0b10000000, 0x00, 0x00, 0b11000000, 0x00, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0x00, 0b01000000, 0b01000000, 0b11000000, 0b01000000, 0x00, 0b01000000, 0b01000000, 0b01000000, 0b01000000, 0b01000000, 0x00, 0b01000000, 0b01000000, 0b11000000, 0b01000000, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0b11000000, 0x00, 0b11000000, 0x00, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0b10000000, 0x00};
int microlength=53;

//0 1 2 3 4 5 6 7 8 9
unsigned char numberB[10][4] = {
{0b00111111, 0b00100000, 0b00100000, 0b00111111}
,{0b00001000, 0b00010000, 0b00111111, 0x00}
,{0b00011000, 0b00100001, 0b00100011, 0b00011100}
,{0b00100010, 0b00100010, 0b00100010, 0b00111111}
,{0b00000011, 0b00001101, 0b00111111, 0b00000001}
,{0b00111111, 0b00100010, 0b00100010, 0b00100001}
,{0b00111111, 0b00100010, 0b00100010, 0b00100011}
,{0b00111100, 0b00100000, 0b00100000, 0b00111111}
,{0b00111111, 0b00100010, 0b00100010, 0b00111111}
,{0b00111110, 0b00100010, 0b00100010, 0b00111111}
};

 unsigned char numberC[10][4] = {
{0b11100000, 0b00100000, 0b00100000, 0b11100000}
,{0b00010000, 0b00010000, 0b11110000, 0b00010000}
,{0b11110000, 0b10010000, 0b00010000, 0b00010000}
,{0b00100000, 0b00100000, 0b00100000, 0b11100000}
,{0x00, 0x00, 0b11110000, 0x00}
,{0b00100000, 0b00100000, 0b00100000, 0b11000000}
,{0b11100000, 0b00100000, 0b00100000, 0b11100000}
,{0x00, 0x00, 0x00, 0b11100000}
,{0b11100000, 0b00100000, 0b00100000, 0b11100000}
,{0b00100000, 0b00100000, 0b00100000, 0b11100000}
};
int numberlength = 4;

int main(){
   EICRB=0x0a; // falling edge
   EIMSK=0x30; // interrupt en
   sei();

   DDRC=0xff;
   DDRB=0xff;
   // 초록은 항상 켜
   DDRD=0xff;
   PORTD=0x03;
   int i=0;
   
   int hour = 15;
   int minute = 30;
   int sec = 0;
   int cnt = 0;

   // 4단계 126ms
   while(1){
      switch(mode){
         case 0:
         if(i==34){
            cnt++;
            if(cnt==7){
               sec++;
               cnt=0;
               if(sec==59){
                  minute++;
                  sec=0;
                  if(minute==59){
                     hour++;
                     minute=0;
                     if(hour==23){
                        hour=0;
                     }
                  }
               }
            }
         }
         // PORTC=timeC[hour][i]+":"+timeC[minute][i]+":"+timeC[sec][i];
         // PORTB=timeB[hour][i]+":"+timeB[minute][i]+":"+timeB[sec][i];
	       if(i < 4)
	       {
	         delay_ms(1);
	         PORTB = numberB[(int)hour/10][i];
	         PORTC = numberC[(int)hour/10][i];
	         i++;
	       }
	       else if(i == 4)
	       {
	         delay_ms(1);
	         PORTB = 0x00;
	         PORTC = 0x00;
	         i++;
	       }
	       else if(i < 9)
	       {
	         delay_ms(1);
	         PORTB = numberB[hour%10][i-5];
	         PORTC = numberC[hour%10][i-5];
	         i++;
	       }
	       else if(i== 9)
	       {
	         delay_ms(1);
	         PORTB = 0x00;
	         PORTC = 0x00;
	         i++;
	       }
	       else if(i == 10)
	       {
	         delay_ms(1);
	         PORTB = 0b00011000;
	         PORTC = 0b11000000;
	         i++;
	       }
	       else if(i == 11)
	       {
	         delay_ms(1);
	         PORTB = 0x00;
	         PORTC = 0x00;
	         i++;
	       }
	       else if(i<16)
	       {
	         delay_ms(1);
	         PORTB = numberB[(int)minute/10][i-12];
	         PORTC = numberC[(int)minute/10][i-12];
	         i++;
          
	       }
	       else if(i == 16)
	       {
	         delay_ms(1);
	         PORTB = 0x00;
	         PORTC = 0x00;
	         i++;
	       }
	       else if(i < 21)
	       {
	         delay_ms(1);
	         PORTB = numberB[minute%10][i-17];
	         PORTC = numberC[minute%10][i-17];
	         i++;
	       }
	       else if(i == 21)
	       {
	         delay_ms(1);
	         PORTB = 0x00;
	         PORTC = 0x00;
	         i++;
	       }
	       else if(i == 22)
	       {
	         delay_ms(1);
	         PORTB = 0b00011000;
	         PORTC = 0b11000000;
	         i++;
	       }
	       else if(i == 23)
	       {
	         delay_ms(1);
	         PORTB = 0x00;
	         PORTC = 0x00;
	         i++;
	       }
	       else if(i < 28)
	       {
	         delay_ms(1);
	         PORTB = numberB[(int)sec/10][i-24];
	         PORTC = numberC[(int)sec/10][i-24];
	         i++;
	       }
	       else if(i == 28)
	       {
	         delay_ms(1);
	         PORTB = 0x00;
	         PORTC = 0x00;
	         i++;
	       }
	       else if(i < 34)
	       {
	         delay_ms(1);
	         PORTB = numberB[sec%10][i-29];
	         PORTC = numberC[sec%10][i-29];
	         i++;
	       }
	       else
	       {
	         i=0;
	         PORTC=0x00;
	         PORTB=0x00;
	         delay_ms(91);
	       } 
      
         break;

         case 1:
         if(i==namelength){
            i=0;
            PORTC=0x00;
            PORTB=0x00;
            delay_ms(96);
         }
         delay_ms(1);
         PORTC=nameC[i];
         PORTB=nameB[i];
         i++;
         break;

         case 2:
         if(i==microlength){
            i=0;
            PORTC=0x00;
            PORTB=0x00;
            delay_ms(71);
         }
         delay_ms(1);
         PORTC=microC[i];
         PORTB=microB[i];
         i++;
         break;

         case 3:
         while(1)
         {
            PORTB = 0xff;
            PORTC = 0xff;
            _delay_ms(50);
            PORTB = 0x00;
            PORTC = 0x00;
            _delay_ms(1600);

         }

       case 4:
       while(1)
       {
          if(i==namelength){
            i=0;
            PORTC=0x00;
            PORTB=0x00;
            delay_ms(96);
            }
            delay_ms(1);
            PORTC=nameC[i];
            PORTB=nameB[i];
            i++;


       }
         break;
      }
   }
}
